(()=>{var w=Object.create;var c=Object.defineProperty;var y=Object.getOwnPropertyDescriptor;var f=Object.getOwnPropertyNames;var $=Object.getPrototypeOf,g=Object.prototype.hasOwnProperty;var _=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports);var v=(r,t,e,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of f(t))!g.call(r,a)&&a!==e&&c(r,a,{get:()=>t[a],enumerable:!(s=y(t,a))||s.enumerable});return r};var m=(r,t,e)=>(e=r!=null?w($(r)):{},v(t||!r||!r.__esModule?c(e,"default",{value:r,enumerable:!0}):e,r));var u=_(()=>{});var d=m(u());var l=m(u());var j=m(u()),p=class{constructor(t,e,s){this.mgr=t,this.pool_name=e,this.name=s}static async list(t,e,s=!1){return await t.httpGet(`/api/v1/pools/${e}/volumes?state=${s?1:0}`)}async get(t=!1){return await this.mgr.httpGet(`/api/v1/pools/${this.pool_name}/volumes/${this.name}?state=${t?1:0}`)}async start(){return await this.mgr.httpPost(`/api/v1/pools/${this.pool_name}/volumes/${this.name}/start`,{})}async stop(){return await this.mgr.httpPost(`/api/v1/pools/${this.pool_name}/volumes/${this.name}/stop`,{})}async delete(){return this.mgr.httpDelete(`/api/v1/pools/${this.pool_name}/volumes/${this.name}`)}};var n=class{constructor(t,e,s){this.mgr=t,this.pool_name=e,this.name=s}static async add(t,e,s,a=""){return await t.httpPost(`/api/v1/pools/${e}/nodes`,{name:s,endpoint:a})}static async list(t,e,s=!1){return await t.httpGet(`/api/v1/pools/${e}/nodes?state=${s?1:0}`)}async get(t=!1){return await this.mgr.httpGet(`/api/v1/pools/${this.pool_name}/nodes/${this.name}?state=${t?1:0}`)}async remove(){return this.mgr.httpDelete(`/api/v1/pools/${this.pool_name}/nodes/${this.name}`)}};var h=class{constructor(t,e){this.mgr=t,this.name=e}static async create(t,e){return await t.httpPost("/api/v1/pools",{name:e})}static async list(t){return await t.httpGet("/api/v1/pools")}async listVolumes(t=!1){return await p.list(this.mgr,this.name,t)}async delete(){return await this.mgr.httpDelete(`/api/v1/pools/${this.name}`)}volume(t){return new p(this.mgr,this.name,t)}node(t){return new n(this.mgr,this.name,t)}async addNode(t,e=""){return await n.add(this.mgr,this.name,t,e)}async listNodes(t=!1){return await n.list(this.mgr,this.name,t)}async rename(t){return this.mgr.httpPost(`/api/v1/pools/${this.name}/rename`,{new_pool_name:t})}};var o=class{constructor(t){this.url=t,this.user_id="",this.api_key_id="",this.token=""}async httpPost(t,e){let s=await fetch(`${this.url}${t}`,{method:"POST",headers:{...this.authHeaders(),"Content-Type":"application/json"},body:JSON.stringify(e)});if(s.status==401||s.status==403)throw new l.default((await s.json()).error);let a=await s.json();if(a.error)throw new Error(a.error);return a}async httpGet(t){let e=await fetch(`${this.url}${t}`,{headers:{...this.authHeaders(),"Content-Type":"application/json"}});if(e.status==401||e.status==403)throw new l.default((await e.json()).error);let s=await e.json();if(s.error)throw new Error(s.error);return s}async httpDelete(t){let e=await fetch(`${this.url}${t}`,{method:"DELETE",headers:{...this.authHeaders(),"Content-Type":"application/json"}});if(e.status==401||e.status==403)throw new l.default((await e.json()).error);if(e.status!==204){let s=await e.json();if(s.error)throw new Error(s.error)}}static fromToken(t,e,s,a){let i=new o(t);return i.user_id=e,i.api_key_id=s,i.token=a,i}authHeaders(){return this.token!=""?{Authorization:`Bearer ${this.token}`,"X-User-ID":this.user_id}:{}}async generateApiKey(t,e){return await this.httpPost(`/api/v1/users/${t}/api-keys`,{password:e})}static async login(t,e,s){let a=new o(t),i=await a.generateApiKey(e,s);return a.user_id=i.user_id,a.api_key_id=i.id,a.token=i.token,a}async logout(){this.api_key_id!=""&&(await this.httpDelete(`/api/v1/api-keys/${this.api_key_id}`),this.api_key_id="",this.user_id="",this.token="")}async listPools(){return await h.list(this)}pool(t){return new h(this,t)}async createPool(t){return await h.create(this,t)}};window.StorageManager=o;window.StorageManagerAuthError=d.default;})();
